window.addEventListener("load",()=>{localStorage.getItem("New_user_request")&&"false"!=localStorage.getItem("New_user_request")||localStorage.setItem("New_user_request","true");const downloadButton=document.querySelector("button#download_app_pwa"),downloadStatus=document.querySelector("div#notify_pwa_version");let activeDownload=!1,deferredPrompt;window.addEventListener("beforeinstallprompt",e=>{localStorage.setItem("PWA_installed","false"),e.preventDefault(),deferredPrompt=e,activeDownload=!0,console.log("Prepared"),$("button#download_app_pwa").removeAttr("disabled"),downloadStatus.querySelector("small").innerHTML=`版本 v${downloadStatus.getAttribute("version")}`,downloadButton.addEventListener("click",()=>{deferredPrompt.prompt(),deferredPrompt.userChoice.then(choiceResult=>{"accepted"===choiceResult.outcome?console.log("User accepted the install prompt"):console.log("User dismissed the install prompt")})})}),setTimeout(()=>{activeDownload||(window.matchMedia("(display-mode: standalone)").matches||window.matchMedia("(display-mode: fullscreen)").matches||!0===window.navigator.standalone||"true"===localStorage.getItem("PWA_installed")?(localStorage.setItem("PWA_installed","true"),downloadStatus.innerHTML=`<small class="text-success">已下载 版本 v${downloadStatus.getAttribute("version")}</small>`):downloadStatus.innerHTML='<diV><small class="text-danger">无法下载 </small><a class="adv small" href="#error_download" onclick="$(\'#collapseEight\').collapse(\'show\')">查看原因</a></div>')},3e3),window.addEventListener("appinstalled",event=>{deferredPrompt=null,console.log("👍","appinstalled",event),localStorage.setItem("PWA_installed","true"),downloadStatus.innerHTML=`<small class="text-success">已下载 版本 v${downloadStatus.getAttribute("version")}</small>`})});